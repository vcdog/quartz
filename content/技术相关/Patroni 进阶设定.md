##### Patroni 故障自动修复

| 故障位置 | 场景                            | Patroni 的动作                                 |
| ---- | ----------------------------- | ------------------------------------------- |
| 备库   | 备库 PG 停止                      | 停止备库 PG                                     |
| 备库   | 停止备库 Patroni                  | 停止备库 PG                                     |
| 备库   | 强杀备库 Patroni（或 Patroni crash） | 无操作                                         |
| 备库   | 备库无法连接 etcd                   | 无操作                                         |
| 备库   | 非 Leader 角色但是 PG 处于生产模式       | 重启 PG 并切换到恢复模式作为备库运行                        |
| 主库   | 主库 PG 停止                      | 重启 PG，重启超过 master_start_timeout 设定时间，进行主备切换 |
| 主库   | 停止主库 Patroni                  | 停止主库 PG，并触发 failover                        |
| 主库   | 强杀主库 Patroni（或 Patroni crash） | 触发 failover，此时可能出现双主                        |
| 主库   | 主库无法连接 etcd                   | 将主库降级为备库，并触发 failover                       |
| -    | etcd 集群故障                     | 将主库降级为备库，此时集群中全部都是备库                        |
| -    | 同步模式下无可用同步备库                  | 临时切换主库为异步复制，在恢复为同步复制之前自动 failover 暂不生效      |

